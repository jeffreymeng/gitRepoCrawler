/* Copyright (c) 2018 Jeffrey Meng | 1.0.0 | MIT License */
!function(t){"use strict";t.GitHubRepoCrawler=function(){function t(t){return t&&"[object Function]"==={}.toString.call(t)}function e(e){var n=new XMLHttpRequest;n.open("GET",e.url+(e.url.indexOf("?")>-1?"":"?")+function(t){if(null==t)return"";var e=[];for(var n in t)t.hasOwnProperty(n)&&null!=t[n]&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e.join("&")}(e.parameters),!0),n.setRequestHeader("Content-Type",e.contentType),n.onload=function(){if(n.status>=200&&n.status<400){var s=n.responseText;t(e.success)&&e.success(s)}else s=n.responseText,t(e.error)&&e.error(s);t(e.always)&&e.always(s)},n.onerror=function(){var t=n.responseText;e.error(t)},n.send()}var n=function(t,s,i){if(!(this instanceof n))return new n(url,i);i?(i.name=s,i.owner=t):s?(i="string"==typeof s?{name:s}:s).owner=t:i=t,this.TYPE="type",this.EXTENSION="extension",this.PATH="path",this._listeners={},this._listeners[this.TYPE]={},this._listeners[this.EXTENSION]={},this._listeners[this.NAME]={},this.on=function(t,e,n){for(var s=e.split(" "),i=0;i<s.length;i++)null==this._listeners[t]?this._listeners[t]={}:null==this._listeners[t][s[i]]?this._listeners[t][s[i]]=new Array(1).fill(n):this._listeners[t][s[i]].push(n)},this.onType=function(t,e){this.on(this.TYPE,t,e)},this.onExtension=function(t,e){this.on(this.EXTENSION,t,e)},this.onName=function(t,e){this.on(this.NAME,t,e)},this.off=function(t,e,n){for(var s=e.split(" "),i=0;i<s.length;i++)if(null!=this._listeners[t]&&null!=this._listeners[t][s[i]])for(var r=0;r<this._listeners[t][s[i]].length;r++)this._listeners[t][s[i]][r]==n&&this._listeners[t][s[i]].splice(r,1)},this.offType=function(t,e){this.off(this.TYPE,t,e)},this.offExtension=function(t,e){this.off(this.EXTENSION,t,e)},this.offName=function(t,e){this.off(this.NAME,t,e)},this.crawl=function(n){if(0!=n){var r=this;n(0,`https://api.github.com/repos/${t}/${s}/contents`)}function n(t,o){e({url:o,contentType:"application/vnd.github.v3+json",parameters:{ref:i.ref},success:function(e){var i,o,h,l,a,f,u,p=JSON.parse(e);for(i=0;i<p.length;i++){if(h=(a=p[i]).type,s=a.name,path=a.path,l=s.split(".")[s.split(".").length-1],u={name:s,path:a.path,type:h,extension:l,depth:t,githubURL:a.html_url,rawURL:a.download_url,githubData:a},f={enterDirectory:!0,stopCrawl:!1},r._listeners.type[h])for(o=0;o<r._listeners.type[h].length;o++)f=r._listeners.type[h][o](u)||f;if(r._listeners.extension[l])for(o=0;o<r._listeners.extension[l].length;o++)f=r._listeners.extension[l][o](u)||f;if(r._listeners.path[path])for(o=0;o<r._listeners.path[path].length;o++)f=r._listeners.path[path][o](u)||f;if(f.stopCrawl)break;"dir"==h&&f.enterDirectory&&n(t+1,a.url)}},error:function(t){throw JSON.parse(t),new Error("GitRepoCrawler: GET Request failed.")}})}}};return n}()}(window);